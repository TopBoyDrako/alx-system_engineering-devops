#!/usr/bin/env bash
# This script installs an Nginx web server

# Update package list and install Nginx
sudo apt update
sudo apt install nginx -y

# Allow incoming connections on ports 22 (SSH) and 80 (HTTP)
sudo ufw allow 22
sudo ufw allow 80

# Enable the firewall and display its status
sudo ufw --force enable
sudo ufw status

# Display the status of the Nginx service
systemctl status nginx

# Write "Hello World!" to the default Nginx index file
echo 'Hello World!' | sudo tee /var/www/html/index.nginx-debian.html > /dev/null

# Restart the Nginx service
sudo service nginx restart

# Check if Nginx is returning the correct response at the root URL
response=$(curl -s -o /dev/null -w "%{http_code}" http://localhost/)
if [ $response -eq 200 ]; then
  echo "Nginx is returning 200 when querying /"
else
  echo "ERROR: Nginx is not returning 200 when querying /"
fi
